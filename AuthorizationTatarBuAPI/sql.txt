CREATE TABLE IF NOT EXISTS roles(
                      role_id int PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
                      name varchar(255) UNIQUE NOT NULL
);

CREATE TABLE IF NOT EXISTS users(
                      user_id uuid primary key,
                      name varchar(255) NOT NULL,
                      login varchar(255) UNIQUE NOT NULL,
                      password varchar(255) NOT NULL,
                      role_id int REFERENCES roles (role_id) on delete set null,
                      avatar int,
                      gender varchar(20) NOT NULL,
                      birth_date timestamp,
                      registered_at timestamp,
                      last_activity_at timestamp,
    check ( gender = 'male' or gender = 'female' )
);

CREATE TABLE IF NOT EXISTS ClassRooms(
    classroom_id uuid PRIMARY KEY,
    name varchar(255),
    teacher uuid REFERENCES users (user_id) on delete SET NULL
);

CREATE TABLE IF NOT EXISTS ClassRooms_Users(
    classroom_id uuid references ClassRooms(classroom_id) on delete cascade,
    user_id uuid references users(user_id) on delete cascade,
    PRIMARY KEY (classroom_id, user_id)
)

insert into roles (name) values ('ROLE_PUPIL');
insert into roles (name) values ('ROLE_TEACHER');
insert into roles (name) values ('ROLE_EDITOR');

insert into users
    (user_id, name, login, password, role_id, avatar, gender, birth_date, registered_at, last_activity_at)
values (gen_random_uuid(), 'SYSTEM_BOT', 'SYSTEM_BOT', 'SYSTEM_BOT', 3, null,  'male', now(), now(), now());